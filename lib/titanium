#!/usr/bin/env node

/**
 * Dependencies
 */
var colors = require('colors'),
    program = require('commander'),
	support = require('./support'),
	commands = require('./commands'),
	VERSION = '0.1.0';

// program
// 	.version(VERSION)
// 	.description('* Titanium Mobile CLI (v' + VERSION + ') *')
// 	.usage('COMMAND [OPTIONS]')
// 	.option('-v, --verbose', 'Verbose logging output');

// program
// 	.command('clean')
// 	.usage('titanium clean [OPTIONS]')
// 	.description('clean shit up')
// 	.option('-f, --fun <fun>', 'a fun option')
// 	.action(function(e){
// 		console.log('cleaning up');
// 	});

// program.on('--help', function(){
//   console.log('  Examples:');
//   console.log('');
//   console.log('    $ custom-help --help');
//   console.log('    $ custom-help -h');
//   console.log('');
// });

// program.parse(process.argv);
// console.log(program);
// process.exit();

function commandHelp(_command) {	
	//help for specific command
	if (_command) {
		var cmd = commands[_command];
		support.printDoc(cmd.doc);
		console.log('');
	}
	else {
		console.log('\n********************************'.magenta);
		console.log('* Titanium Mobile CLI (v0.0.2) *'.magenta);
		console.log('********************************\n'.magenta);
		console.log('Run "titanium help [command]" for usage information...\n');
		support.printAligned('help', 'Print this command listing');
		for (var command in commands) {
			support.printAligned(command, commands[command].doc.description);
		}
		console.log('');
	}
}

//process input
if (process.argv.length < 3 || process.argv[2] === 'help') {
	commandHelp(process.argv[3]);
}
else {
	var command = process.argv[2],
		opts = commands[command].getOptions();

	// Parse command-specific arguments
	opts.forEach(function(opt) {
		program.option(opt[0], opt[1], opt[2], opt[3]);
	});
	program.parse(process.argv);
	program.args.shift();

	// Launch the command
	commands[command].execute(
		program.args, 
		program,      
		new support.Logger(program.verbose || false)
	);
}
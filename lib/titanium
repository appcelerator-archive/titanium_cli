#!/usr/bin/env node

/**
 * Dependencies
 */
var colors = require('colors'),
    program = require('commander'),
	support = require('./support'),
	commands = require('./commands'),
	constants = require('./support/constants');

function commandHelp(_command) {	
	//help for specific command
	if (_command) {
		var cmd = commands[_command];
		support.printDoc(cmd.doc);
		console.log('');
	}
	else {
		console.log('\n********************************'.magenta);
		console.log(('* Titanium Mobile CLI (v' + constants.TITANIUM_CLI_VERSION+ ') *').magenta);
		console.log('********************************\n'.magenta);
		console.log('Run "titanium help [command]" for usage information...\n');
		support.printAligned('help', 'Print this command listing');
		for (var command in commands) {
			support.printAligned(command, commands[command].doc.description);
		}
		console.log('');
	}
}

//process input
if (process.argv.length < 3 || process.argv[2] === 'help') {
	commandHelp(process.argv[3]);
}
else {
	var command = process.argv[2],
		opts = commands[command].doc.options;

	// Parse command-specific arguments
	opts.forEach(function(opt) {
		program.option(opt[0], opt[1], opt[2], opt[3]);
	});
	program.parse(process.argv);
	program.args.shift();

	// Launch the command
	commands[command].execute(
		program.args, 
		program,      
		new support.Logger(program.verbose || false)
	);
}